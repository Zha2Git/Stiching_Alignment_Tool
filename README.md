# Stiching_Alignment_Tool
Stiching and Alignment Tool for microscopy images by python

# This toolkit consists of two tools: image stitching and alignment for microscopy images

## Getting started

Download the folder from Github.

From the **terminal**, access that folder using **cd** to arrive to that folder path, as it will be used as the working directory.

If you have root access, to install the required librairies for the code, you can run in the terminal from that folder:

```bash
python3 -m pip install -r requirements.txt
```

else if you do not have root access (e.g from a server or multi-account computer), you can run:

```bash
python3 -m pip install --user -r requirements.txt
```

This installs all the libraries that you require for the process (via pip, which is built-in by default with python3).


## Function discribtion

### Tool 1: Image Stitching tool

This image stitching program was independently developed by Y.Zhang. The main program is contained in Notebook OmeTiff_Stiching_Batch_Processing.ipynb. Please follow the instructions within.

1. Program Functions and Operation Instructions

1.1 The filenames of the series of image fragments generated by fluorescence microscopy contain the coordinates of the lower right vertex of the image. These images to be stitched should be stored in a separate folder.

1.2 If there are multiple stitching tasks, the fragment files for each image need to be placed in a separate folder.

1.3 All stitching task fragment folders should be stored in a single root directory.

1.4 Set the root directory in OmeTiff_Stiching_Batch_Processing.ipynb, and then run it.

1.5 This program can batch complete each stitching task in all subfolders under the main folder. The status of each individual task will be output to a Log file.

1.6 For each individual stitching task, this program iterates through all TIFF files, removes files containing keywords, and filters out all unstitched fragment files.

1.7 The program calculates the size of the stitched target image based on the coordinates of all fragment files, determining the position of each fragment within the target image.

1.8 The program generates target files, retaining the layer names of the fragment files, and saves them in their respective subfolders, ending with XXXX_Combined.ome.tif.

1.9 These stitched target files will be provided to the next alignment tool for alignment and layer merging operations.

### Tool 2: Image Alignment tool.

This program is modified and optimized based on the core program of HiFiAlignmentTool. Parameters can be set and alignment and stitching can be started in the main.ipynb Notebook, simplifying operation.

Program Functions and Operation Instructions.

2.1 Copy the stitched target image to be aligned and merged to the source folder, keeping the filename format as xxxx.ome.tif. For example, Panel1_Combined.ome.tif, Panel2_Combined.ome.tif, etc.

2.2 Open the `channel_name` directory, modify the filename to match the file to be aligned (excluding the `.ome.tif` extension), and name each layer.

2.3 Open `main.ipynb`, check the parameter settings according to the instructions, and then run the program.

2.4 The aligned single image will be output to the `aligned` folder, with the filename containing the `al` field.

2.4 If the parameters are set to output the final file (default setting), after the program runs successfully, the synthesized uncompressed image file will be output in the same folder as `main.ipynb`, named `final_image.ome.tif`. A pyramid-sampled compressed image named `pyr_inal_image.ome.tif` will also be generated.

If you want to call the `main.py` function through the command-line interface instead of running it in Juypter Notebook, or to learn about the detailed functions of each module of HiFiAlignmentTool, please read the README file of the original developer.
