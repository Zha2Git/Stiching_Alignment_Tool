# Stiching_Alignment_Tool

This toolkit consists of two tools: **image stitching** and **alignment** for microscopy images.

---

## Table of Contents

- [Getting Started](#getting-started)
  - [Installation](#installation)
- [Tool Descriptions](#tool-descriptions)
  - [Tool 1: Image Stitching](#tool-1-image-stitching)
  - [Tool 2: Image Alignment](#tool-2-image-alignment)
- [Advanced Usage](#advanced-usage)

---

## Getting Started

### Download

Download the folder from **GitHub**.

### Setup Working Directory

From the **terminal**, access the downloaded folder using `cd` to navigate to the folder path, as it will be used as the **working directory**.

### Installation

**If you have root access**, run in the terminal from that folder:

```bash
python3 -m pip install -r requirements.txt
```

**If you do not have root access** (e.g., from a server or multi-account computer), run:

```bash
python3 -m pip install --user -r requirements.txt
```

> ðŸ“¦ This installs all the required libraries via **pip** (built-in by default with Python 3).

---

## Tool Descriptions

## Tool Descriptions

### Tool 1: Image Stitching

**Developer**: Independently developed by Y.Zhang  
**Main Program**: `OmeTiff_Stiching_Batch_Processing.ipynb`

> ðŸ’¡ Please follow the instructions within the Notebook

#### Program Functions and Operation Instructions

##### 1.1 Input File Requirements

- The filenames of **image fragment series** generated by fluorescence microscopy contain the **coordinates** of the lower right vertex of the image
- Images to be stitched should be stored in a **separate folder**

##### 1.2 Multi-Task Organization

- If there are **multiple stitching tasks**, the fragment files for each image need to be placed in a **separate folder**
- All stitching task fragment folders should be stored in a **single root directory**

##### 1.3 Program Configuration

Set the **root directory** in `OmeTiff_Stiching_Batch_Processing.ipynb`, then run the program.

##### 1.4 Batch Processing

- The program can **batch complete** all stitching tasks in all subfolders under the main folder
- The status of each individual task will be output to a **Log file**

##### 1.5 Processing Workflow

- The program iterates through all **TIFF files**, removes files containing keywords
- Filters out all **unstitched fragment files**
- Calculates the size of the stitched target image based on the **coordinates** of all fragment files
- Determines the **position** of each fragment within the target image

##### 1.6 Output Results

- The program generates **target files**, retaining the **layer names** of the fragment files
- Saves them in their respective subfolders, ending with `XXXX_Combined.ome.tif`
- These stitched target files will be provided to the **next alignment tool** for alignment and layer merging operations

---

### Tool 2: Image Alignment

**Based on**: Modified and optimized from the core program of **HiFiAlignmentTool**  
**Main Program**: `main.ipynb`

> ðŸ”§ Simplified operationâ€”parameters can be set and alignment can be started within the Notebook

#### Program Functions and Operation Instructions

##### 2.1 Prepare Input Files

- Copy the stitched target image to be aligned and merged to the `source` folder
- Keep the filename format as `xxxx.ome.tif`
- **Examples**: `Panel1_Combined.ome.tif`, `Panel2_Combined.ome.tif`, etc.

##### 2.2 Configure Channel Names

- Open the `channel_name` directory
- Modify the filename to match the file to be aligned (**excluding** the `.ome.tif` extension)
- Name each layer

##### 2.3 Run the Program

- Open `main.ipynb`
- Check the **parameter settings** according to the instructions
- Run the program

##### 2.4 Output Results

**Aligned Single Images**:
- Output to the `aligned` folder
- Filename contains the `al` field

**Final Composite Files** (if parameters are set to output, default enabled):
- **Uncompressed image**: `final_image.ome.tif` (in the same folder as `main.ipynb`)
- **Pyramid-sampled compressed image**: `pyr_final_image.ome.tif`

---

## Advanced Usage

### Command-Line Interface

If you want to call the `main.py` function through the **command-line interface** instead of running it in **Jupyter Notebook**, or to learn about the detailed functions of each module of **HiFiAlignmentTool**, please read the **README file of the original developer**.

